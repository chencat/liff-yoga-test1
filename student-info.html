<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>個人資訊</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <style>
        .div-background {
            background-image: url("https://amymhaddad.s3.amazonaws.com/morocco-blue.png");
            height: 160px;
            width: 100%;
        }
    </style>

    <script src="https://code.jquery.com/jquery-3.6.3.min.js"
        integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
</head>

<body>

    <nav class="navbar">
        <div class="container-fluid justify-content-center">
            <h1 class="navbar-brand">個人資訊</h1>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="card">
            <div class="d-flex flex-row div-background align-items-center mt-3 mb-1">
                <div class="d-flex flex-column align-self-center flex-fill align-items-center justify-content-center">
                    <h2 id="profile"></h2>
                    <h5 id="line"></h5>
                    <form class="pe-2 d-none">
                        <div class="form-group d-flex flex-row mb-2">
                            <label class="align-self-center flex-fill mx-2" style="width: 50px;"
                                for="exampleInputEmail1">姓名</label>
                            <input type="email" class="form-control" id="exampleInputEmail1"
                                aria-describedby="emailHelp" placeholder="Enter email">
                        </div>
                        <div class="form-group d-flex flex-row">
                            <label class="align-self-center flex-fill mx-2" style="width: 50px;"
                                for="exampleInputEmail1">姓名</label>
                            <input type="email" class="form-control" id="exampleInputEmail1"
                                aria-describedby="emailHelp" placeholder="Enter email">
                        </div>
                    </form>
                </div>
                <img id="line-profile-picture" src="./5399908.png" class="align-self-center me-3"
                    style="width: 128px;height: 128px;" alt="">
            </div>

            <div class="d-flex flex-row align-items-center mb-1">
                <img src="./5399908.png" class="align-self-center mx-3" style="width: 11px;height: 11px;" alt="">
                <small class="text-muted align-self-center flex-fill">Last updated 3 mins ago</small>
                <!-- <div class="align-self-end me-3">日期</div> -->
                <button class="btn btn-primary align-self-end me-3" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                </button>
            </div>
            <div class="collapse px-4 py-2" id="collapseExample">

                Some placeholder content for the collapse component. This panel is hidden by default but revealed
                when the user activates the relevant trigger.

            </div>
            <div class="d-flex flex-row align-items-center mb-1">
                <img src="./5399908.png" class="align-self-center mx-3" style="width: 11px;height: 11px;" alt="">
                <small class="text-muted align-self-center flex-fill">Last updated 3 mins ago</small>
                <div class="align-self-end me-3">1234567890</div>
            </div>
            <form class="p-3 d-none">
                <div class="form-group">
                    <textarea class="form-control" id="exampleFormControlTextarea1" rows="5"></textarea>
                </div>
            </form>
        </div>
    </div>

    <script>

        let liffID = '1657127222-vlpYeZjK';

        liff.init({
            liffId: liffID
        }).then(function () {
            console.log('LIFF init');

            // 這邊開始寫使用其他功能

            // login call, only when external browser or LINE's in-app browser is used
            if (!liff.isLoggedIn()) {
                liff.login();
            } else {

                const idToken = liff.getIDToken();
                // console.log(idToken); // print raw idToken object

                get_me(idToken)

                liff.getProfile().then(profile => {
                    // console.log(profile)
                    let userId = profile.userId;
                    // $('#profile').text(`${profile.displayName}`)
                    $('#line').text(`LINE ID：${profile.displayName}`)
                    $("#line-profile-picture").attr("src", profile.pictureUrl);

                });

            }
        }).catch(function (error) {
            console.log(error);
            liff.logout();
        });

    </script>

    <script>

        function get_me(token) {

            axios.get('http://localhost:8000/ccdartstudio/me', {
                headers: {
                    'Authorization': `${token}`
                }
            })
                .then(function (response) {
                    console.log(response);
                    // $('#profile').text('測試')
                    // $('#profile').text(`${profile.displayName}`)
                })
                .catch(function (error) {
                    console.log(error);
                });

        }

    </script>

</body>

</html>